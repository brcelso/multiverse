#drive Google
https://drive.google.com/drive/folders/13g30GlEJ3Xrz18TPO5u2gJLKOR3RjJqv

https://docs.github.com/en/authentication/troubleshooting-ssh/error-permission-denied-publickey

https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent


hostname: WLX7003COPRS User: mlwkt100
Diretorio: home/mlwkt100/Ansible ( Chave ssh)

# Procedimento para adicionar uma maquina no Invetario ( Hosts)
Adicionar no arquivo hosts ( /etc/hosts) o ip e hostname para podemos nos comunicar pelo hostname.
Adcionar no arquivo hosts do Ansible (/etc/ansible/ansible.cfg)

# Arquivo .yaml para instalação do ADA ubuntu e SRA.
sraxagent.yaml ( Para executar nas maquinas que estão apontadas no arquivo hosts do ansible.cfg )
$ ansible-playbook sraxagent.yaml 

# Comandos necessarios

$ ssh-copy-id -i opsinfra.pub mlwkt100@wlxxxxmtmnnn
Comando ssh-copy-id -i para chamar a chave publica que vai ser copiada para o hostname em seguida.
### OBS: Precisamos encontrar um email de distribuir a chave publica para todas as maquinas.

ansible-playbook SRAAGENT.yaml --ask-become-pass


Como enviar a chave publica para varios hosts

# ansible-playbook -i hosts chavekey.yaml

# sudo dpkg -l | grep ada | awk '/^ii/{print $2, $3}' | head -n 1

# sudo ./aengine -status | grep "Relay connection is:"

# sudo service ssh status

# sudo dmidecode -t 1

#particionar ssd
sudo apt-get install gparted

#alterar hostname
sudo hostnamectl set-hostname xxx

# sudo apt install net-tools
instala o ifconfig

# apt-get install openssh-server
instala ssh

#remover chave ssh antiga
ssh-keygen -f "/home/celso/.ssh/known_hosts" -R "note-lab"
rm known_hosts

#copiar
scp -r producao mlwkt500@ipdestino:/home/mlwkt500

#remover ADA 
sudo dpkg -r ada

#reiniciar ADA
vim /opt/automatos/ada/etc/aengine.cfg
vim /opt/automatos/ada/etc/arelay.cfg
sudo systemctl restart aengine
sudo systemctl restart arelay

#instalar ada
sudo dpkg -i ada
GFL sudo ./asetup -s -a -s -ialmaden@gflogistica.com.br -bLINUX -ca127.0.0.1:1999 -crssl:lad1-receiver.almaden.app:443
MAGALU sudo ./asetup -s -a -s -iautomatos@magazineluiza.com.br -bLINUX -ca127.0.0.1:1999 -crssl:lad1-receiver.almaden.app:443

#logs ADA diretorio
#instalar o ethtool para o automatos 
#coletar info da maquina
cd /var/opt/automatos/ada
aengine_20240528_0855.elog 
arelay_20240528_0829.rlog
sudo chmod 775 aengine_20240528_0855.elog
sudo chmod 775 arelay_20240528_0829.rlog 

#reiniciar SRA
service isl_always_on stop
service isl_always_on start
service isl_always_on status

#reiniciar gdm3 (parte grafica linux)
sudo nano /etc/gdm3/custom.conf
descomente a linha "WaylandEnable-false" e salve o arquivo
sudo systemctl restart gdm3

#alterar permissoes de grupo
groups mlwkt500
sudo usermod -aG adm,cdrom,sudo,dip,plugdev,lpadmin,lxd mlwkt500

sudo adduser mlwkt500
sudo usermod -aG sudo mlwkt500

#remover pasta
sudo rm -rf /diretorio

#remover antivirus
sudo apt-get --purge remove ds-agent

#permissoes bluetooth
Add ControllerMode = bredr to /etc/bluetooth/main.conf by using sudo gedit /etc/bluetooth/main.conf
Run sudo service bluetooth restart
Turn Bluetooth off and back on on the Bluetooth page in settings
Connect to Airpod (works)
------------------
#instalar Ansible e copiar pasta producao para a Pasta Pessoal

sudo apt update
sudo apt install software-properties-common
sudo add-apt-repository --yes --update ppa:ansible/ansible
sudo apt install ansible

#configurar arquivo ansible.cfg
sudo nano /etc/ansible/ansible.cfg

[defaults]
host_key_checking = false
#private_key_file=/home/mlwkt100/Ansible/opsinfra

*todos comandos abaixo devem ser
executados dentro da pasta Ansible

#configurar o dns em /etc/hosts
sudo nano /etc/hosts

#criar o arquivo hosts e colocar grupos e ips
e no final user e senhas adm
sudo nano hosts

#criar o playbook com os scripts
sudo nano exemplo.yaml

#validar comunicacao com a maquina destino
ansible -i hosts MTM -k -m ping

MTM = grupo desejado no arquivo hosts
-k = envia user adm e pede permissao

#rodar playbook
[script primario]
ansible-playbook -i hosts -k exemplo.yaml

[script alternativo]
ansible-playbook -i hosts -k exemplo.yaml
--ask-become-pass

#maquina kleber - 10.46.218.157

https://pt.linux-console.net/?p=13897#google_vignette

sudo usermod -aG lpadmin mlwkt500
sudo usermod -aG sambashare mlwkt500

------------------------

#listar servicos
systemctl list-units --type=service

#servico de acesso remoto (ISAlwaysOn)
isl_always_on.service 

#reiniciar servico islalwayson
sudo systemctl restart isl_always_on.service

#coletar info maquina
sudo lshw

#executar playbook
ansible-playbook -i /home/mlwkt500/AI/ansible/hosts /home/mlwkt500/AI/ansible/scripts/padronizado.yml --ask-become-pass